<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Face Recognition App Documentation</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --navy: #1a237e;
            --dark-navy: #0d1b69;
            --light-navy: #3949ab;
            --cyan: #00bcd4;
            --blue: #2196f3;
            --green: #4caf50;
            --orange: #ff9800;
            --white: #ffffff;
            --light: #e8eaf6;
            --dark: #0a0e27;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, var(--navy) 100%);
            color: var(--white);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        .header {
            text-align: center;
            padding: 40px 0;
            background: linear-gradient(135deg, var(--dark-navy), var(--navy));
            border-radius: 20px;
            margin-bottom: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .subtitle {
            font-size: 1.3rem;
            color: var(--cyan);
            margin-bottom: 20px;
        }

        .author {
            background: linear-gradient(135deg, var(--blue), var(--cyan));
            padding: 12px 25px;
            border-radius: 50px;
            display: inline-block;
            font-weight: 600;
        }

        .section {
            background: rgba(30, 42, 94, 0.9);
            margin-bottom: 30px;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
            border: 1px solid var(--light-navy);
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--blue);
        }

        .section-header i {
            font-size: 1.8rem;
            margin-right: 12px;
            color: var(--cyan);
        }

        .section-header h2 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .subsection h3 {
            font-size: 1.4rem;
            color: var(--blue);
            margin: 20px 0 10px 0;
        }

        .code-block {
            background: var(--dark);
            border: 1px solid var(--light-navy);
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            overflow-x: auto;
            color: var(--light);
        }

        .highlight { background: var(--green); color: white; padding: 2px 5px; border-radius: 3px; }
        .warning { background: var(--orange); color: white; padding: 2px 5px; border-radius: 3px; }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .card {
            background: var(--dark);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid var(--light-navy);
        }

        .card h4 { color: var(--cyan); margin-bottom: 8px; }

        .info-box {
            background: rgba(33, 150, 243, 0.1);
            border-left: 4px solid var(--cyan);
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
            background: var(--dark);
            border-radius: 8px;
            overflow: hidden;
        }

        .table th {
            background: var(--blue);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .table td {
            padding: 10px 12px;
            border-bottom: 1px solid var(--light-navy);
        }

        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin: 15px 0;
        }

        .tech-item {
            background: linear-gradient(135deg, var(--blue), var(--light-navy));
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
        }

        @media print {
            body { background: white; color: black; }
            .section { page-break-inside: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1><i class="fas fa-user-check"></i> Face Recognition App</h1>
            <div class="subtitle">Technical Documentation & Implementation Guide</div>
            <div class="author">
                <i class="fas fa-user-graduate"></i> Created by Chetan S Shelake
            </div>
        </div>

        <!-- Project Overview -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-rocket"></i>
                <h2>Project Overview</h2>
            </div>
            
            <div class="subsection">
                <h3>What is Face Recognition App?</h3>
                <p>A sophisticated Laravel web application that leverages AWS Rekognition for advanced facial recognition. Users can register individuals with photos and perform accurate face matching with similarity scoring.</p>
                
                <div class="info-box">
                    <strong>Key Innovation:</strong> Combines AWS cloud services with modern web technologies for enterprise-grade face recognition with intuitive UI.
                </div>
            </div>

            <div class="subsection">
                <h3>Core Features</h3>
                <div class="grid">
                    <div class="card">
                        <h4><i class="fas fa-user-plus"></i> Person Registration</h4>
                        <p>Register individuals with photos, validate single face detection using AWS Rekognition</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-search"></i> Face Matching</h4>
                        <p>Compare uploaded photos against registered database with similarity scoring</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-cloud"></i> Cloud Storage</h4>
                        <p>Secure photo storage using AWS S3 with presigned URLs</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-history"></i> Match History</h4>
                        <p>Track all matching attempts with detailed results</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>Technology Stack</h3>
                <div class="tech-stack">
                    <span class="tech-item">Laravel 11</span>
                    <span class="tech-item">PHP 8.2+</span>
                    <span class="tech-item">MySQL</span>
                    <span class="tech-item">AWS Rekognition</span>
                    <span class="tech-item">AWS S3</span>
                    <span class="tech-item">Bootstrap 5</span>
                    <span class="tech-item">JavaScript</span>
                </div>
            </div>
        </div>

        <!-- AWS Configuration -->
        <div class="section">
            <div class="section-header">
                <i class="fab fa-aws"></i>
                <h2>AWS Configuration & Setup</h2>
            </div>

            <div class="subsection">
                <h3>AWS Services Used</h3>
                <div class="grid">
                    <div class="card">
                        <h4><i class="fas fa-eye"></i> AWS Rekognition</h4>
                        <p>AI-powered face detection and comparison service for analyzing facial features with high accuracy.</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-cloud"></i> AWS S3</h4>
                        <p>Scalable object storage for securely storing user photos with access control.</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>Step-by-Step AWS Setup</h3>
                
                <h4>1. Create AWS Account & IAM User</h4>
                <ol>
                    <li>Sign up at <span class="highlight">aws.amazon.com</span></li>
                    <li>Go to IAM Console → Users → Create User</li>
                    <li>Attach policies for S3 and Rekognition</li>
                    <li>Generate Access Keys → Download CSV</li>
                </ol>

                <h4>2. S3 Bucket Setup</h4>
                <div class="code-block">
# Create S3 bucket
aws s3 mb s3://attendance-photos-raja --region ap-south-1

# Set private access policy
aws s3api put-bucket-policy --bucket attendance-photos-raja --policy file://policy.json
                </div>

                <h4>3. Rekognition Collection</h4>
                <div class="code-block">
# Create collection
aws rekognition create-collection --collection-id face-recognition-collection --region ap-south-1

# Verify creation
aws rekognition list-collections --region ap-south-1
                </div>
            </div>

            <div class="subsection">
                <h3>IAM Permissions Required</h3>
                <div class="code-block">
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject", "s3:PutObject", "s3:DeleteObject",
        "rekognition:DetectFaces", "rekognition:CompareFaces"
      ],
      "Resource": "*"
    }
  ]
}
                </div>
            </div>
        </div>

        <!-- Database Design -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-database"></i>
                <h2>Database Design</h2>
            </div>

            <div class="subsection">
                <h3>Database Schema</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Table</th>
                            <th>Purpose</th>
                            <th>Key Fields</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><span class="highlight">people</span></td>
                            <td>Store registered individuals</td>
                            <td>id, name, photo_s3_key, is_active</td>
                        </tr>
                        <tr>
                            <td><span class="highlight">face_matches</span></td>
                            <td>Track matching attempts</td>
                            <td>id, matched_person_id, similarity_score, is_match</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="subsection">
                <h3>Migration Code</h3>
                <div class="code-block">
// People table
Schema::create('people', function (Blueprint $table) {
    $table->id();
    $table->string('name');
    $table->string('photo_s3_key');
    $table->boolean('is_active')->default(true);
    $table->timestamps();
});

// Face matches table
Schema::create('face_matches', function (Blueprint $table) {
    $table->id();
    $table->string('uploaded_photo_s3_url');
    $table->string('uploaded_photo_s3_key');
    $table->foreignId('matched_person_id')->nullable()->constrained('people');
    $table->decimal('similarity_score', 5, 2)->nullable();
    $table->boolean('is_match')->default(false);
    $table->timestamps();
});
                </div>
            </div>
        </div>

        <!-- Backend Implementation -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-server"></i>
                <h2>Backend Implementation</h2>
            </div>

            <div class="subsection">
                <h3>Core Controller Logic</h3>
                
                <h4>Face Registration Process</h4>
                <div class="code-block">
public function register(Request $request)
{
    $request->validate([
        'name' => 'required|string|max:255',
        'photo' => 'required|image|mimes:jpeg,png,jpg|max:5120',
    ]);

    try {
        // Upload to S3
        $uploadResult = $this->rekognitionService->uploadToS3($request->file('photo'), 'photos');
        
        // Detect faces
        $faceDetection = $this->rekognitionService->detectFaces($uploadResult['s3_key']);
        
        // Validate single face
        if ($faceDetection['face_count'] !== 1) {
            return back()->with('error', 'Please upload photo with exactly one face.');
        }
        
        // Store in database
        Person::create([
            'name' => $request->name,
            'photo_s3_key' => $uploadResult['s3_key'],
            'is_active' => true
        ]);
        
        return redirect()->route('face.index')->with('success', 'Person registered!');
        
    } catch (Exception $e) {
        return back()->with('error', 'Registration failed: ' . $e->getMessage());
    }
}
                </div>

                <h4>Face Matching Process</h4>
                <div class="code-block">
public function match(Request $request)
{
    $request->validate([
        'person_id' => 'required|exists:people,id',
        'photo' => 'required|image|max:5120',
    ]);

    try {
        $selectedPerson = Person::findOrFail($request->person_id);
        
        // Upload new photo
        $uploadResult = $this->rekognitionService->uploadToS3($request->file('photo'), 'uploads');
        
        // Compare faces
        $comparisonResult = $this->rekognitionService->compareFaces(
            $selectedPerson->photo_s3_key,  // Source
            $uploadResult['s3_key'],        // Target
            85.0                            // Threshold
        );
        
        $similarity = $comparisonResult['highest_similarity'];
        $isMatch = $comparisonResult['is_match'];
        
        // Store result
        FaceMatch::create([
            'uploaded_photo_s3_key' => $uploadResult['s3_key'],
            'matched_person_id' => $selectedPerson->id,
            'similarity_score' => $similarity,
            'is_match' => $isMatch
        ]);
        
        return view('face.match-result', compact('similarity', 'isMatch'));
        
    } catch (Exception $e) {
        return back()->with('error', 'Matching failed: ' . $e->getMessage());
    }
}
                </div>
            </div>

            <div class="subsection">
                <h3>AWS Rekognition Service</h3>
                <div class="code-block">
class RekognitionService
{
    private $rekognitionClient;
    private $s3Client;
    
    public function compareFaces(string $sourceKey, string $targetKey, float $threshold = 85.0): array
    {
        try {
            // Download images as bytes
            $sourceBytes = $this->s3Client->getObject(['Bucket' => $this->bucket, 'Key' => $sourceKey])['Body']->getContents();
            $targetBytes = $this->s3Client->getObject(['Bucket' => $this->bucket, 'Key' => $targetKey])['Body']->getContents();
            
            // Compare faces
            $result = $this->rekognitionClient->compareFaces([
                'SourceImage' => ['Bytes' => $sourceBytes],
                'TargetImage' => ['Bytes' => $targetBytes],
                'SimilarityThreshold' => $threshold,
            ]);

            $matches = $result['FaceMatches'] ?? [];
            $highestSimilarity = 0;
            
            foreach ($matches as $match) {
                $similarity = $match['Similarity'];
                if ($similarity > $highestSimilarity) {
                    $highestSimilarity = $similarity;
                }
            }

            return [
                'success' => true,
                'highest_similarity' => $highestSimilarity,
                'is_match' => $highestSimilarity >= $threshold,
            ];
            
        } catch (Exception $e) {
            return ['success' => false, 'error' => $e->getMessage()];
        }
    }
}
                </div>
            </div>
        </div>

        <!-- Frontend Implementation -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-desktop"></i>
                <h2>Frontend Implementation</h2>
            </div>

            <div class="subsection">
                <h3>Modern UI Features</h3>
                <div class="grid">
                    <div class="card">
                        <h4><i class="fas fa-upload"></i> Drag & Drop Upload</h4>
                        <p>Interactive file upload with preview and validation</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-chart-bar"></i> Similarity Visualization</h4>
                        <p>Progress bars and color-coded confidence levels</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-mobile-alt"></i> Responsive Design</h4>
                        <p>Bootstrap 5 with mobile-first approach</p>
                    </div>
                    <div class="card">
                        <h4><i class="fas fa-palette"></i> Dark Theme</h4>
                        <p>Professional gradient backgrounds and modern styling</p>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3>JavaScript Functionality</h3>
                <div class="code-block">
// Drag and drop upload
uploadZone.addEventListener('drop', function(e) {
    e.preventDefault();
    const files = e.dataTransfer.files;
    if (files.length > 0) {
        photoInput.files = files;
        handleFileSelect(files[0]);
    }
});

// File validation
function handleFileSelect(file) {
    if (!file.type.match('image.*')) {
        alert('Please select a valid image file.');
        return;
    }
    if (file.size > 5 * 1024 * 1024) {
        alert('File size must be less than 5MB.');
        return;
    }
    // Show preview
    const reader = new FileReader();
    reader.onload = function(e) {
        previewImage.src = e.target.result;
        photoPreview.classList.remove('d-none');
    };
    reader.readAsDataURL(file);
}
                </div>
            </div>
        </div>

        <!-- Security & Configuration -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-shield-alt"></i>
                <h2>Security & Configuration</h2>
            </div>

            <div class="subsection">
                <h3>Environment Configuration (.env)</h3>
                <div class="code-block">
APP_NAME="Face Recognition App"
APP_ENV=local
APP_DEBUG=true
APP_URL=http://localhost:8000

DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=face_detection
DB_USERNAME=root
DB_PASSWORD=

# AWS Configuration
AWS_ACCESS_KEY_ID=AKIAQTXFPFMNBGZN7NVV
AWS_SECRET_ACCESS_KEY=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
AWS_DEFAULT_REGION=ap-south-1
AWS_BUCKET=attendance-photos-raja

# Rekognition Settings
AWS_REKOGNITION_COLLECTION_ID=face-recognition-collection
AWS_REKOGNITION_FACE_MATCH_THRESHOLD=50
                </div>
                
                <div class="info-box">
                    <strong><i class="fas fa-exclamation-triangle"></i> Security Note:</strong> 
                    In production, use IAM roles instead of hardcoded credentials. Store sensitive data in AWS Secrets Manager.
                </div>
            </div>

            <div class="subsection">
                <h3>Security Features</h3>
                <ul>
                    <li><span class="highlight">CSRF Protection</span> - All forms protected against cross-site request forgery</li>
                    <li><span class="highlight">File Validation</span> - Type, size, and content validation for uploads</li>
                    <li><span class="highlight">Presigned URLs</span> - Temporary access to S3 objects without exposing credentials</li>
                    <li><span class="highlight">Soft Deletes</span> - Data integrity through logical deletion</li>
                    <li><span class="highlight">Input Sanitization</span> - Filename sanitization and SQL injection prevention</li>
                </ul>
            </div>
        </div>

        <!-- Deployment Guide -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-rocket"></i>
                <h2>Deployment Guide</h2>
            </div>

            <div class="subsection">
                <h3>Local Development Setup</h3>
                <ol>
                    <li>Clone repository and install dependencies</li>
                    <li>Configure <span class="highlight">.env</span> file with database and AWS credentials</li>
                    <li>Run migrations: <span class="highlight">php artisan migrate</span></li>
                    <li>Start server: <span class="highlight">php artisan serve</span></li>
                </ol>
            </div>

            <div class="subsection">
                <h3>Production Deployment</h3>
                <ol>
                    <li>Set up web server (Apache/Nginx)</li>
                    <li>Configure SSL certificates</li>
                    <li>Set <span class="warning">APP_ENV=production</span></li>
                    <li>Use <span class="warning">APP_DEBUG=false</span></li>
                    <li>Configure proper file permissions</li>
                    <li>Set up automated backups</li>
                </ol>
            </div>
        </div>

        <!-- Conclusion -->
        <div class="section">
            <div class="section-header">
                <i class="fas fa-check-circle"></i>
                <h2>Conclusion</h2>
            </div>
            
            <p>This Face Recognition App demonstrates the successful integration of modern web technologies with cloud-based AI services. The application provides a robust, scalable solution for facial recognition with enterprise-grade security and user experience.</p>
            
            <div class="info-box">
                <strong>Project Achievements:</strong>
                <ul>
                    <li>✅ Successful AWS Rekognition integration</li>
                    <li>✅ Secure S3 photo storage with presigned URLs</li>
                    <li>✅ Modern responsive UI with Bootstrap 5</li>
                    <li>✅ Comprehensive error handling and logging</li>
                    <li>✅ Professional code architecture and documentation</li>
                </ul>
            </div>
            
            <div style="text-align: center; margin-top: 30px; padding: 20px; background: linear-gradient(135deg, var(--blue), var(--cyan)); border-radius: 10px;">
                <h3><i class="fas fa-trophy"></i> Project Successfully Completed</h3>
                <p><strong>Developed by: Chetan S Shelake</strong></p>
                <p>Full-Stack Developer & AWS Solutions Architect</p>
            </div>
        </div>
    </div>

    <script>
        // Print functionality
        function printDoc() {
            window.print();
        }
        
        // Add print button
        document.addEventListener('DOMContentLoaded', function() {
            const printBtn = document.createElement('button');
            printBtn.innerHTML = '<i class="fas fa-print"></i> Print PDF';
            printBtn.style.cssText = 'position: fixed; top: 20px; right: 20px; background: var(--blue); color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; z-index: 1000;';
            printBtn.onclick = printDoc;
            document.body.appendChild(printBtn);
        });
    </script>
</body>
</html>
